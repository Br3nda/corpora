{% extends 'corpus/base.html' %}
{% load static sekizai_tags  compress  i18n %}


{% block content %}
{% addtoblock "css" %}
<style type="text/x-scss">
@import 'corpora/css/colors';
@import 'corpora/css/text';
@import 'corpus/css/record';
@import 'corpus/scss/actionButtons';
@import 'corpus/scss/sentences';

@import 'bower_components/bootstrap/scss/functions';
@import 'bower_components/bootstrap/scss/mixins';
@import 'bower_components/bootstrap/scss/variables';
div.content{
  padding: 60px 0px 60px 0px;
}
.container.record{
  min-height: 500px;  
}

.vis-container{
  @include media-breakpoint-up(md){
    position: absolute;
    bottom: 0px;
    height: 40%;
  }
}
.visualizer{
  width: 100%;
  @include media-breakpoint-up(md){
    height: 100%;
  }
  height: 80px;
  border-radius: 4px;
  background-color: white;
  border:0px solid $brand_primary;
}
.sentence{
  font-size: 2em !important;
}
a.btn{
  display: inline-block;
}


.circle-button-container{
    padding-bottom: 30px;

  @include media-breakpoint-down(lg){
/*    padding-top: 15px;
*/  }

}
</style>
{% endaddtoblock %}

{% include 'people/profile_header.html' %}

<div class="container record">

  <div class="row align-items-top sentence-block" id="recorder-container">

    <div class="col-12" style="display: none;">
      <div id="status-message" class="error-message" style="display: none;"><h2></h2></div>
    </div>

    <div class="col-12 col-md-7 col-lg-8" >
      <div class="row align-items-bottom" style="height:100%;">
        <div class="col-12 sentence align-items-bottom">
         
        </div>
        <div class="col-12 vis-container">
          <canvas class="visualizer " style=""></canvas>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-5 col-lg-4 "> 

      <div class="row ">

        <div class="col-12">

          {% include 'corpus/_player.button.html' %}

        </div>

        <div class="col-12 actions" style="text-align: center;" >
          <a href="javascript:void(0)" id="redo" class=" disabled redo">
            <i class="fa fa-undo fw"></i> {% trans "Redo" %}
          </a>

          <a href="javascript:void(0)" id="save" class=" disabled save">
            <i class="fa fa-save fw"></i> {% trans "Save" %}
          </a>
          <a href="javascript:void(0)" id="next" class=" next">
            <i class="fa fa-step-forward fw"></i> {% trans "Skip" %}
          </a>
        </div>

      </div>

    </div>
  </div>


</div>



{% comment %}
<small> Does this recording sound accurate? If so, press Next. If not, go back and fix it with Back.</small>
<a href="{% url 'corpus:submit_recording' %}">
    <div class="button submit-audio">
        Submit
    </div>
</a>



{% endcomment %}
    
    
<audio id="play-audio" style="display: none; width: 0px; height: 0px"></audio>

{% addtoblock "js" %}<script type="text/javascript" src="{% static 'bower_components/js-cookie/src/js.cookie.js' %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script type="text/javascript" src="{% static 'bower_components/opus-recorderjs/dist/recorder.min.js' %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script type="text/javascript" src="{% static 'bower_components/opus-recorderjs/dist/waveWorker.min.js' %}"></script>{% endaddtoblock %}

{% addtoblock "js-end" %}<script type="text/javascript" src="{% static 'corpus/js/ajax.post.js' %}"></script>{% endaddtoblock %}
{% addtoblock "js-end" %}<script type="text/javascript" src="{% static 'corpus/js/record.js' %}"></script>{% endaddtoblock %}
{% addtoblock "js-end" %}<script type="text/javascript" src="{% static 'corpus/js/sentence.js' %}"></script>{% endaddtoblock %}
{% addtoblock "js-end" %}<script type="text/javascript" src="{% static 'corpus/js/player.js' %}"></script>{% endaddtoblock %}

{% addtoblock "js-end" %}
<script type="text/javascript">
  var player = new Player('#play-audio');

  var person_pk = "{{person.pk}}";
  var sentence_pk = "{{sentence.pk}}";

  var sentences = new Sentences(
    '{{person.id}}',
    '{{content_type}}',
    '?recording=True')
  sentences.next()



  $('a.next').on('click', function(){
    sentences.show_loading()
    audio.pause()
    recording=false;
    if (recorder!=null){
      recorder.clearStream()
    }
    audio.src = null

    $('.circle-button-container').find('.play, .stop').hide()
    $('.save').addClass('disabled');
    $('.foreground-circle.record').removeClass('clicked-circle').addClass('unclicked-circle');
    $('.redo').addClass('disabled');
    
    $('.circle-button-container .record').show()    
  })

  $('.save').on('click', function(){
    sentences.show_loading()
  })


  $(document).ready(function(){
    $('.circle-button-container .record').show()
    $('.circle-button-container').find('.play, .stop').hide()
    $('.foreground-circle.stop').addClass('clicked-circle').removeClass('unclicked-circle');

  })


</script>
{% endaddtoblock %}


{% endblock %}